---
- name: Run flux.py locally (debug)
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
    - name: Run flux.py from BUTCHER directory
      ansible.builtin.shell: |
        echo "PLAYBOOK_DIR = {{ playbook_dir }}"
        cd "{{ playbook_dir }}/.."
        echo "PWD after cd:"
        pwd

        echo "Listing detection/:"
        ls detection || echo "detection/ NOT FOUND"

        echo "Running: python3 detection/flux.py"
        python3 detection/flux.py
      args:
        executable: /bin/bash
      register: flux_result
      ignore_errors: true

    - name: Show stdout
      ansible.builtin.debug:
        var: flux_result.stdout

    - name: Show stderr
      ansible.builtin.debug:
        var: flux_result.stderr

    - name: Show return code
      ansible.builtin.debug:
        var: flux_result.rc
